-material_count = material.offerings.count
- if material.parent
  - material_count = material_count + material.parent.offerings.count
.material_icon
  .icon_image
    -if(material.class.to_s=="Investigation")
      - link_url = browse_investigation_url(material)
      =image_tag("search/investigation.gif",:size=>"100x100")
    -else
      - link_url = browse_activity_url(material)
      =image_tag("search/activity.gif",:size=>"100x100")
%div
  - if current_user.portal_teacher
    - teacher_clazz_ids = current_user.portal_teacher.teacher_clazzes.select{|item| item.active == true}.map{|item| item.clazz_id}
    - offerings=Portal::Offering.where(:runnable_id=>material.id, :runnable_type=>"#{material.class.to_s}", :clazz_id=>teacher_clazz_ids)
  
  %div{:style=>'overflow:hidden'}
    %table{:width=>"100%"}
      %tr
        %td
        %td
          %span.material_header
            = link_to "#{material.name}","javascript:void(0)", :onclick=>"browseMaterial('#{link_url}')" 
          - if material.parent
            %span
              from investigation
              ="\"#{material.parent.name}\""
          -unless material.user.name.nil?
            %div
              %span{:style=>"font-weight:bold"}
                ="By #{material.user.name}"
        %td{:width=>"75px"}
          %div{:style=>'float:right'}
            = link_to "Preview",run_url_for(material,{}),:class=>"button"
        %td{:width=>"130px"}
          %div{:style=>'float:right'}
            = link_to "Assign to a Class","javascript:void(0)", :onclick=>"browseMaterial('#{link_url}')", :class=>"button"
      %tr
        %td{:colspan=>3}
          - if current_user.portal_teacher
            - teacher_clazz_ids = current_user.portal_teacher.teacher_clazzes.sort{|a,b| a.position <=> b.position}.map{|item| item.clazz_id}
            - offerings = offerings.sort{|a,b| teacher_clazz_ids.index(a.clazz_id) <=> teacher_clazz_ids.index(b.clazz_id)}
            - offering_clazz_names = offerings.map{|o| o.clazz.name}
            - if(offerings.length>0)
              %span.assignedTo
                (Assigned to
                = offering_clazz_names.join(", ")+")"
.material_body
  -unless material.description.nil? || material.description.blank?
    = material.description.html_safe
  %i
    -if(material_count == 0)
      Not used in any class.
    -elsif(material_count == 1)
      Used in 1 class.
    -else
      Used in #{material_count} classes.
    = link_to 'show more details...', 'javascript:void(0)', :onclick => "browseMaterial('#{link_url}');"
  - required_equipments = probe_types(material).map { |p| p.name }.join(", ") 
  - unless required_equipments == ""
    #required_equipment_container
      %span#required_equipment
        Required sensor(s):
      %span{:style=>"font-weight:bold;"}
        = "#{required_equipments} "
